<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Art Flâneur — The Codex</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              background: '#0e0f12',
              paper: '#1a1b1e',
              border: '#2e2f34',
              accent: '#ff5c00',
              'accent-dim': 'rgba(255, 92, 0, 0.1)',
              core: '#57a6ff',
              gameplay: '#a884ff',
              ops: '#4ad6b2',
              business: '#ffba5c',
            },
            fontFamily: {
              sans: ['Inter', 'ui-sans-serif', 'system-ui', 'sans-serif'],
              serif: ['Playfair Display', 'Merriweather', 'serif'],
              mono: ['JetBrains Mono', 'Fira Code', 'monospace'],
            },
            animation: {
              'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
              'pipeline': 'pipeline 2s linear infinite',
              'flow': 'flow 1s linear infinite',
            },
            keyframes: {
               pipeline: {
                  '0%': { transform: 'translateX(-100%)' },
                  '100%': { transform: 'translateX(300%)' }
               },
               flow: {
                  '0%': { strokeDashoffset: '20' },
                  '100%': { strokeDashoffset: '0' }
               }
            }
          },
        },
      };
    </script>

    <!-- Styles -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&family=JetBrains+Mono:wght@400;500&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <style>
      body {
        background-color: #0e0f12;
        color: #e4e4e7;
        font-family: 'Inter', sans-serif;
        overflow-x: hidden;
      }
      .bg-noise {
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E");
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        pointer-events: none;
      }
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      ::-webkit-scrollbar-track {
        background: #0e0f12;
      }
      ::-webkit-scrollbar-thumb {
        background: #3f3f46;
        border-radius: 3px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #52525b;
      }
      /* 3D Flip Utilities */
      .perspective-1000 { perspective: 1000px; }
      .transform-style-3d { transform-style: preserve-3d; }
      .backface-hidden { backface-visibility: hidden; }
      .rotate-y-180 { transform: rotateY(180deg); }
    </style>

    <!-- Import Map & Libraries -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.292.0",
        "d3": "https://esm.sh/d3@7.8.5"
      }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="stylesheet" href="/index.css">
</head>
  <body>
    <div class="bg-noise"></div>
    <div id="root"></div>

    <script type="text/babel" data-type="module" data-presets="react,typescript">
      import React, { useState, useMemo, useEffect, useRef } from 'react';
      import { createRoot } from 'react-dom/client';
      import { 
        Book, Search, Activity, Zap, Database, 
        Smartphone, Lock, Check, Copy,
        Users, Flag, Trophy,
        Unlock, Shield, Eye, Cloud, 
        CreditCard, Star, GitBranch, 
        GitCommit, ArrowRight, Layers, RefreshCw,
        Filter, CheckCircle2, Map, List,
        Network, Grid, Settings2, Download, FileJson, Cpu,
        RefreshCcw, AlertCircle, Terminal
      } from 'lucide-react';
      import * as d3 from 'd3';

      // ----------------------------------------------------------------------
      // CONSTANTS & DATA
      // ----------------------------------------------------------------------

      const MODULES = [
        { id: 'spine', label: 'Spine' },
        { id: 'discover', label: 'Discover' },
        { id: 'quests', label: 'Quest Engine' },
        { id: 'badges', label: 'Badges' },
        { id: 'stories', label: 'Stories' },
        { id: 'points', label: 'Points' },
        { id: 'content', label: 'Content' },
        { id: 'telemetry', label: 'Telemetry' },
        { id: 'entitlements', label: 'Entitlements' },
        { id: 'persona', label: 'Persona' },
        { id: 'db', label: 'DB/tx_log' },
      ];

      const EDGES = [
        { from: 'spine', to: 'discover', weight: 2, types: ['events', 'ux'], reason: 'Routes actions' },
        { from: 'spine', to: 'quests', weight: 2, types: ['events'], reason: 'Dispatches domain events' },
        { from: 'spine', to: 'db', weight: 1, types: ['data'], reason: 'State pointers' },
        { from: 'discover', to: 'quests', weight: 3, types: ['events'], reason: 'Starts quest intent' },
        { from: 'discover', to: 'content', weight: 3, types: ['data'], reason: 'Reads catalog' },
        { from: 'quests', to: 'db', weight: 4, types: ['data'], reason: 'Persists progress' },
        { from: 'quests', to: 'points', weight: 4, types: ['events'], reason: 'Triggers rewards' },
        { from: 'quests', to: 'badges', weight: 3, types: ['events'], reason: 'Unlock triggers' },
        { from: 'badges', to: 'db', weight: 3, types: ['data'], reason: 'Stores unlocks' },
        { from: 'points', to: 'db', weight: 4, types: ['data'], reason: 'Append-only ledger' },
        { from: 'entitlements', to: 'points', weight: 2, types: ['data'], reason: 'Multipliers' },
      ];

      const CONTENT = {
        en: {
          header: {
            title: "Art Flâneur",
            subtitle: "System Blueprint",
            version: "The Codex v6.2",
            desc: "A comprehensive technical and design specification for the MVP. Focusing on the 'skeleton of experience': Discover → Quest → Reward → Return.",
            badge: "Gaming Mechanics v6.2",
            features: {
              offline: { title: "Offline First", desc: "Core loops work without connectivity." },
              idempotent: { title: "Idempotent", desc: "Tx_log ensures zero duplicate rewards." },
              safeops: { title: "Safe Ops", desc: "No PII, strict telemetry allowlists." },
              content: { title: "Content Driven", desc: "Releases via immutable bundles." }
            }
          },
          nav: {
            core: "Core Systems",
            gameplay: "Gameplay",
            ops: "Operations",
            business: "Business"
          },
          sections: {
            overview: {
              title: "0. MVP Overview",
              intro: "We define the MVP strictly to prove the core loop. We do not build 'magic' features yet.",
              content: "Everything is deterministic based on local state + content bundles. The goal is to validate the 'Flâneur' behavior—aimless wandering with purpose.",
              keyDecisions: "Key Technical Decisions",
              nonGoals: "Immediate Non-Goals",
              listDecisions: ["Event-driven architecture for loose coupling", "Idempotency first (tx_log) for robust rewards", "Content releases via immutable JSON bundles", "Telemetry is strictly opt-in (privacy first)"],
              listNonGoals: ["Real NFT minting (simulated only)", "GPS geo-fencing (using QR/manual instead)", "Social leaderboards (local only)", "Generative AI dialogs (scripted only)"]
            },
            core_loop: {
              title: "1. Core Loop",
              intro: "The loop is the heartbeat of the application: Discover → Location → Quest → Reward → Return.",
              invariant: "Design Invariant: The loop must be completable offline. State reconciliation happens silently on next connect.",
              stepsTitle: "Detailed Flow Steps",
              steps: [
                "Hydration: App loads content bundle vX.Y.Z and user state (tx_log).",
                "Discovery: User browses the 'Map' or 'List' based on time/distance.",
                "Intent: User accepts a Quest (State: Active).",
                "Execution: User performs tasks (Photo, QR Scan, Check-in).",
                "Validation: Local validator checks constraints (Time, Location).",
                "Completion: Reward transaction appended to local ledger.",
                "Sync: Background worker pushes tx_log to cloud when online."
              ]
            },
            points: {
              title: "2. Economy & Points",
              intro: "The economy is built on a strict Double-Entry Ledger system. Visual displays are projections of the transaction log.",
              codeLabel: "Economy State Shape"
            },
            characters: {
              title: "3. Characters",
              intro: "Characters are archetypes that drive the tone of the quests.",
              list: [
                { title: "Gallerist", desc: "Focuses on curation, exhibition history, and artistic intent." },
                { title: "Historian", desc: "Provides context, dates, political movements, and facts." },
                { title: "Dealer", desc: "Discusses market value, provenance, and ownership." },
                { title: "Layperson", desc: "Pure emotional reaction, accessibility, and 'vibes'." }
              ]
            },
            quests: {
              title: "4. Quest Engine",
              intro: "Quests are finite state machines defined entirely in JSON.",
              codeLabel: "Quest Definition (JSON)"
            },
            badges: {
              title: "5. Badges System",
              intro: "Badges serve as the persistent memory of the player's journey. They function as a 'Tech Tree' of experiences.",
              details: {
                concept: "Badges are logic gates. The 'Baroque Expert' badge is not just a trophy; it is a key that unlocks the 'Royal Palace' quest line. The system builds a dependency graph of achievements.",
                technical: "Implemented as a Directed Acyclic Graph (DAG) of requirements. The `BadgeResolver` runs effectively as a compiler: `Input(History) -> Output(AvailableQuests)`."
              }
            },
            stories: {
              title: "6. Stories & Routes",
              intro: "The engine supports two distinct modes of engagement: 'Roaming' (Graph) and 'Events' (Linear).",
              details: {
                concept: "Users toggle between 'Flâneur Mode' (wander freely between connected nodes) and 'Narrative Mode' (strict step-by-step storytelling, e.g., a Murder Mystery).",
                technical: "Roaming uses a spatial graph `Node <-> Node` where edges have weights (distance/time). Events use a strict array `[Step1, Step2, Step3]` with `previous_step_complete` validation."
              }
            },
            monetization: {
              title: "7. Monetization",
              intro: "We sell 'Access' and 'Amplification', not consumable content. The 'Patron' model.",
              details: {
                concept: "The Patron Card is a digital asset that glows in the UI. It applies a global 1.5x multiplier to all XP earned and unlocks hidden 'Curator' audio tracks in every quest.",
                technical: "The `EntitlementsModule` wraps the `RewardCalculator`. Before any transaction is written to the ledger, it checks for a valid, non-expired `patron_token` in the secure storage."
              }
            },
            persona: {
              title: "8. Persona Radar",
              intro: "The system quietly builds a psychographic profile based on user actions, not stated preferences.",
              details: {
                concept: "If you always choose the 'Historical Fact' dialogue option, your Historian score grows. This alters the map: historical venues pulse brighter, commercial galleries fade.",
                technical: "A 4-dimensional normalized vector `[G, H, D, L]`. Each quest completion emits a `persona_delta` vector. The user's profile is a rolling average with time-decay, ensuring the profile evolves."
              }
            },
            telemetry: {
              title: "9. Telemetry (Safe)",
              intro: "Privacy by Design. We track the 'Crowd', never the 'Individual'.",
              details: {
                concept: "Data moves through a 'Privacy Funnel'. Identifiers are stripped on the client. Only aggregated coordinate buckets and timestamp buckets reach the server.",
                technical: "Client-side sanitizer runs before network dispatch. `UserID` is replaced with `EphemeralSessionID` (rotates daily). Lat/Long is rounded to 3 decimal places (~100m accuracy)."
              }
            },
            content: {
              title: "10. Content Releases",
              intro: "Immutable Infrastructure. The world updates like a software deployment.",
              details: {
                concept: "We don't rely on live API calls for quest text. Everything is bundled. A 'Festival' is a zip file containing JSON logic, images, and audio, downloaded once.",
                technical: "`ContentManager` maintains a stack of active bundles. `BaseGame + KyivBundle + ChristmasSpecial`. Assets are addressed via hash-based paths to ensure cache consistency."
              }
            },
            devnotes: {
              title: "11. Developer Notes",
              intro: "Topological map of system modules."
            }
          }
        },
        ru: {
          header: {
            title: "Art Flâneur",
            subtitle: "Системный Блупринт",
            version: "Кодекс v6.2",
            desc: "Комплексная техническая и дизайнерская спецификация для MVP. Фокус на «скелете опыта»: Обнаружение → Квест → Награда → Возвращение.",
            badge: "Игровая Механика v6.2",
            features: {
              offline: { title: "Offline First", desc: "Основные циклы работают без сети." },
              idempotent: { title: "Идемпотентность", desc: "Tx_log предотвращает дублирование." },
              safeops: { title: "Безопасность", desc: "Никаких PII, строгие белые списки." },
              content: { title: "Контент-код", desc: "Релизы через неизменяемые бандлы." }
            }
          },
          nav: {
            core: "Ядро Системы",
            gameplay: "Геймплей",
            ops: "Операции",
            business: "Бизнес"
          },
          sections: {
            overview: {
              title: "0. Обзор MVP",
              intro: "Мы определяем MVP строго для проверки основного цикла.",
              content: "Цель — валидация поведения «Фланёра». Все детерминировано на основе локального состояния.",
              keyDecisions: "Ключевые Технические Решения",
              nonGoals: "Не является целью",
              listDecisions: ["Событийно-ориентированная архитектура", "Идемпотентность (tx_log)", "Неизменяемые JSON бандлы", "Телеметрия по согласию"],
              listNonGoals: ["Настоящий минтинг NFT", "GPS гео-фенсинг", "Социальные лидерборды", "Генеративный AI"]
            },
            core_loop: {
              title: "1. Основной Цикл",
              intro: "Сердце приложения: Обнаружение → Локация → Квест → Награда → Возвращение.",
              invariant: "Инвариант: Цикл должен быть проходим офлайн.",
              stepsTitle: "Детализация Шагов",
              steps: [
                "Гидратация: Загрузка бандла и состояния.",
                "Обнаружение: Карта или Список.",
                "Намерение: Принятие Квеста.",
                "Исполнение: Фото/QR/Чекин.",
                "Валидация: Локальные проверки.",
                "Завершение: Запись в tx_log.",
                "Синхронизация: Отправка логов в облако."
              ]
            },
            points: {
              title: "2. Экономика и Очки",
              intro: "Система двойной записи. Баланс — это проекция журнала транзакций.",
              codeLabel: "Структура Состояния"
            },
            characters: {
              title: "3. Персонажи",
              intro: "Архетипы, задающие тон квестов.",
              list: [
                { title: "Галерист", desc: "Кураторство, история выставок." },
                { title: "Историк", desc: "Контекст, даты, факты." },
                { title: "Дилер", desc: "Рынок, провенанс, владение." },
                { title: "Обыватель", desc: "Эмоции, доступность, вайб." }
              ]
            },
            quests: {
              title: "4. Движок Квестов",
              intro: "Квесты — это конечные автоматы (FSM) в JSON.",
              codeLabel: "Определение Квеста"
            },
            badges: {
              title: "5. Система Бейджей",
              intro: "Бейджи — это персистентная память пути. Они работают как «Дерево технологий» опыта.",
              details: {
                concept: "Бейджи — это логические вентили. Бейдж «Эксперт Барокко» — это ключ, открывающий цепочку квестов «Королевский Дворец». Система строит граф зависимостей достижений.",
                technical: "Реализовано как направленный ациклический граф (DAG). `BadgeResolver` работает как компилятор: `Input(История) -> Output(ДоступныеКвесты)`."
              }
            },
            stories: {
              title: "6. Истории и Маршруты",
              intro: "Движок поддерживает два режима: «Блуждание» (Граф) и «События» (Линейность).",
              details: {
                concept: "Игрок переключается между режимом Фланёра (свободное перемещение между узлами) и Нарративным режимом (строгая последовательность, например, детектив).",
                technical: "Блуждание использует пространственный граф `Узел <-> Узел`. События используют строгий массив `[Шаг1, Шаг2]` с валидацией `previous_step_complete`."
              }
            },
            monetization: {
              title: "7. Монетизация",
              intro: "Мы продаем «Доступ» и «Усиление». Модель «Меценат».",
              details: {
                concept: "Карта Мецената — цифровой актив. Она дает глобальный множитель 1.5x к опыту и открывает скрытые аудио-треки «Куратора» в квестах.",
                technical: "Модуль `Entitlements` оборачивает `RewardCalculator`. Перед записью транзакции он проверяет наличие валидного `patron_token` в защищенном хранилище."
              }
            },
            persona: {
              title: "8. Радар Персоны",
              intro: "Система строит психографический профиль на основе действий, а не заявлений.",
              details: {
                concept: "Если вы всегда выбираете «Исторический факт» в диалогах, ваш счет Историка растет. Это меняет карту: исторические места светятся ярче.",
                technical: "4-мерный нормализованный вектор `[G, H, D, L]`. Завершение квеста эмитирует вектор изменений. Профиль пользователя — это скользящее среднее с затуханием по времени."
              }
            },
            telemetry: {
              title: "9. Телеметрия (Safe)",
              intro: "Privacy by Design. Мы отслеживаем «Толпу», а не «Личность».",
              details: {
                concept: "Данные проходят через «Воронку приватности». Идентификаторы стираются на клиенте. На сервер попадают только агрегированные бакеты координат.",
                technical: "Санитайзер работает на клиенте до отправки. `UserID` заменяется на `EphemeralSessionID` (rotates daily). Lat/Long is rounded to 3 decimal places (~100m accuracy)."
              }
            },
            content: {
              title: "10. Релизы Контента",
              intro: "Неизменяемая инфраструктура. Мир обновляется как деплой софта.",
              details: {
                concept: "Мы не зависим от API для текстов. «Фестиваль» — это zip-архив с логикой и медиа, загружаемый один раз.",
                technical: "`ContentManager` поддерживает стек активных бандлов. `BaseGame + KyivBundle + ChristmasSpecial`. Ассеты адресуются по хешам для консистентности кеша."
              }
            },
            devnotes: {
              title: "11. Заметки Разработчика",
              intro: "Топологическая карта модулей."
            }
          }
        }
      };

      // ----------------------------------------------------------------------
      // UI COMPONENTS
      // ----------------------------------------------------------------------

      const Sidebar = ({ 
        sections, 
        activeId, 
        onNavigate, 
        lang, 
        setLang, 
        text 
      }) => {
        return (
          <aside className="w-80 h-screen fixed left-0 top-0 border-r border-border bg-[#0e0f12]/95 backdrop-blur-xl flex flex-col z-50 transition-transform duration-300 lg:translate-x-0">
            <div className="p-6 border-b border-border">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-accent to-orange-700 flex items-center justify-center shadow-lg shadow-orange-900/20">
                  <Book className="text-white" size={20} />
                </div>
                <div>
                  <h1 className="font-serif font-bold text-lg text-zinc-100 leading-tight">Art Flâneur</h1>
                  <p className="text-[10px] uppercase tracking-widest text-zinc-500 font-bold mt-0.5">{text.header.version}</p>
                </div>
              </div>
            </div>

            <div className="px-4 py-4">
              <div className="flex bg-paper border border-border rounded-lg p-1 mb-4">
                {['en', 'ru'].map((l) => (
                   <button 
                   key={l}
                   onClick={() => setLang(l)}
                   className={`flex-1 text-xs font-bold py-1.5 rounded transition-colors uppercase ${lang === l ? 'bg-zinc-700 text-white' : 'text-zinc-500 hover:text-zinc-300'}`}
                 >
                   {l}
                 </button>
                ))}
              </div>

              <div className="relative group">
                <Search className="absolute left-3 top-2.5 text-zinc-500 group-focus-within:text-accent transition-colors" size={16} />
                <input 
                  type="text" 
                  placeholder={lang === 'en' ? "Search mechanics..." : "Поиск механик..."}
                  className="w-full bg-paper border border-border rounded-lg py-2 pl-9 pr-4 text-sm text-zinc-200 placeholder-zinc-600 focus:outline-none focus:border-accent/50 focus:ring-1 focus:ring-accent/50 transition-all"
                />
              </div>
            </div>

            <nav className="flex-1 overflow-y-auto px-4 py-2 space-y-8 custom-scrollbar pb-10">
              {['core', 'gameplay', 'ops', 'business'].map((group) => {
                const groupSections = sections.filter(s => s.group === group);
                if (groupSections.length === 0) return null;

                return (
                  <div key={group}>
                    <h3 className="text-[10px] uppercase tracking-[0.2em] font-bold text-zinc-500 mb-3 ml-2 flex items-center gap-2">
                      <span className={`w-1.5 h-1.5 rounded-full ${
                        group === 'core' ? 'bg-core' : 
                        group === 'gameplay' ? 'bg-gameplay' : 
                        group === 'ops' ? 'bg-ops' : 'bg-business'
                      }`}></span>
                      {text.nav[group] || group}
                    </h3>
                    <div className="space-y-0.5">
                      {groupSections.map(section => (
                        <button
                          key={section.id}
                          onClick={() => onNavigate(section.id)}
                          className={`
                            w-full text-left px-3 py-2 rounded-lg text-sm transition-all flex items-center gap-3
                            ${activeId === section.id 
                              ? 'bg-zinc-800 text-zinc-100 font-medium shadow-md translate-x-1' 
                              : 'text-zinc-400 hover:text-zinc-200 hover:bg-zinc-900/50'}
                          `}
                        >
                          <span className={`w-1 h-1 rounded-full transition-all ${activeId === section.id ? 'bg-accent scale-125' : 'bg-zinc-700'}`}></span>
                          <span className="truncate">{section.title}</span>
                        </button>
                      ))}
                    </div>
                  </div>
                );
              })}
            </nav>
          </aside>
        );
      };

      const CodeBlock = ({ label, content }) => {
        const [copied, setCopied] = React.useState(false);

        const handleCopy = () => {
          navigator.clipboard.writeText(content);
          setCopied(true);
          setTimeout(() => setCopied(false), 2000);
        };

        return (
          <div className="my-6 rounded-xl border border-border bg-[#141415] overflow-hidden shadow-2xl">
            <div className="flex items-center justify-between px-4 py-2 bg-white/5 border-b border-white/5">
              <span className="text-xs font-mono text-zinc-500">{label}</span>
              <button 
                onClick={handleCopy}
                className="text-zinc-500 hover:text-zinc-300 transition-colors"
              >
                {copied ? <Check size={14} /> : <Copy size={14} />}
              </button>
            </div>
            <pre className="p-4 overflow-x-auto text-xs font-mono text-zinc-300 leading-relaxed">
              {content}
            </pre>
          </div>
        );
      };

      const Callout = ({ children }) => (
        <div className="my-6 p-4 rounded-lg bg-accent/5 border-l-2 border-accent text-sm text-zinc-300">
          {children}
        </div>
      );

      const FeatureGrid = ({ items }) => (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 my-8">
          {items.map((item, idx) => (
            <div key={idx} className="p-4 rounded-xl bg-paper border border-border hover:border-zinc-600 transition-colors group">
              <div className="mb-3 text-zinc-500 group-hover:text-zinc-300 transition-colors">{item.icon}</div>
              <h4 className="font-bold text-zinc-200 text-sm mb-1">{item.title}</h4>
              <p className="text-xs text-zinc-500 leading-relaxed">{item.desc}</p>
            </div>
          ))}
        </div>
      );

      const SectionWrapper = ({ id, title, children }) => {
        return (
          <section id={id} className="scroll-mt-24 mb-24 animate-in fade-in slide-in-from-bottom-8 duration-700">
            <div className="flex items-center gap-4 mb-6">
              <h2 className="text-3xl font-serif font-bold text-zinc-100">{title}</h2>
              <div className="h-px flex-1 bg-gradient-to-r from-zinc-800 to-transparent"></div>
            </div>
            <div className="text-zinc-400 leading-relaxed space-y-6">
              {children}
            </div>
          </section>
        );
      };

      // ----------------------------------------------------------------------
      // DIAGRAM COMPONENTS
      // ----------------------------------------------------------------------

      const FlowDiagram = () => (
        <svg viewBox="0 0 760 260" className="w-full h-auto rounded-xl bg-gradient-to-b from-white/5 to-white/0 border border-white/10 p-4">
          <defs>
            <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto">
              <path d="M0,0 L10,3 L0,6 Z" fill="currentColor" className="text-zinc-500" />
            </marker>
          </defs>
          <text fill="currentColor" className="text-zinc-200 text-sm font-bold" x="14" y="22">Architecture Flow</text>
          
          <path d="M210 105 C 225 105, 225 100, 240 100" fill="none" markerEnd="url(#arrow)" stroke="currentColor" className="text-zinc-700" strokeWidth="2" />
          <text fill="currentColor" className="text-zinc-500 text-xs font-mono" x="215" y="95">dispatch</text>
          
          <path d="M410 100 C 430 100, 430 95, 450 95" fill="none" markerEnd="url(#arrow)" stroke="currentColor" className="text-zinc-700" strokeWidth="2" />
          <text fill="currentColor" className="text-zinc-500 text-xs font-mono" x="420" y="90">route</text>
          
          <path d="M630 95 C 645 95, 645 105, 660 105" fill="none" markerEnd="url(#arrow)" stroke="currentColor" className="text-zinc-700" strokeWidth="2" />
          <text fill="currentColor" className="text-zinc-500 text-xs font-mono" x="635" y="93">persist</text>

          <rect className="fill-core/20 stroke-core/30" x="40" y="70" width="170" height="70" rx="12" strokeWidth="1" />
          <text fill="currentColor" className="text-zinc-100 text-xs font-bold" x="54" y="97">AppShell</text>
          <text fill="currentColor" className="text-zinc-400 text-[10px]" x="54" y="113">(UI/Navigation)</text>

          <rect className="fill-core/10 stroke-core/30" x="240" y="60" width="170" height="80" rx="12" strokeWidth="1" />
          <text fill="currentColor" className="text-zinc-100 text-xs font-bold" x="254" y="92">Spine</text>
          <text fill="currentColor" className="text-zinc-400 text-[10px]" x="254" y="108">(contracts)</text>

          <rect className="fill-gameplay/10 stroke-gameplay/30" x="450" y="50" width="180" height="90" rx="12" strokeWidth="1" />
          <text fill="currentColor" className="text-zinc-100 text-xs font-bold" x="464" y="79">Modules</text>
          <text fill="currentColor" className="text-zinc-400 text-[10px]" x="464" y="95">Discover/Quests</text>
          <text fill="currentColor" className="text-zinc-400 text-[10px]" x="464" y="111">Badges/Stories</text>

          <rect className="fill-ops/10 stroke-ops/30" x="660" y="70" width="100" height="70" rx="12" strokeWidth="1" />
          <text fill="currentColor" className="text-zinc-100 text-xs font-bold" x="674" y="105">DB</text>
        </svg>
      );

      const StateDiagram = () => (
        <svg viewBox="0 0 760 240" className="w-full h-auto rounded-xl bg-gradient-to-b from-white/5 to-white/0 border border-white/10 p-4">
          <defs>
            <marker id="arrow2" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto">
              <path d="M0,0 L10,3 L0,6 Z" fill="currentColor" className="text-zinc-500" />
            </marker>
          </defs>
          <text fill="currentColor" className="text-zinc-200 text-sm font-bold" x="14" y="22">Quest State Machine</text>
          
          <path d="M140 140 C 230 140, 230 90, 320 90" fill="none" markerEnd="url(#arrow2)" stroke="currentColor" className="text-zinc-700" strokeWidth="2" />
          <text fill="currentColor" className="text-zinc-500 text-xs font-mono" x="212" y="107">start</text>
          
          <path d="M320 90 C 420 90, 420 70, 520 70" fill="none" markerEnd="url(#arrow2)" stroke="currentColor" className="text-zinc-700" strokeWidth="2" />
          <text fill="currentColor" className="text-zinc-500 text-xs font-mono" x="402" y="72">complete</text>

          <circle cx="140" cy="140" r="24" className="fill-zinc-800 stroke-zinc-600" strokeWidth="2" />
          <text textAnchor="middle" fill="currentColor" className="text-zinc-300 text-[10px] font-bold" x="140" y="144">Idle</text>

          <circle cx="320" cy="90" r="24" className="fill-gameplay/20 stroke-gameplay" strokeWidth="2" />
          <text textAnchor="middle" fill="currentColor" className="text-zinc-100 text-[10px] font-bold" x="320" y="94">Active</text>

          <circle cx="520" cy="70" r="24" className="fill-ops/20 stroke-ops" strokeWidth="2" />
          <text textAnchor="middle" fill="currentColor" className="text-zinc-100 text-[10px] font-bold" x="520" y="74">Done</text>
        </svg>
      );

      const Heatmap = () => {
        const [view, setView] = useState('matrix');
        const [selectedCell, setSelectedCell] = useState(null);
        const svgRef = useRef(null);

        useEffect(() => {
          if (view === 'graph' && svgRef.current) {
            const width = svgRef.current.clientWidth || 800;
            const height = 500;
            
            const svg = d3.select(svgRef.current);
            svg.selectAll("*").remove();

            const nodes = MODULES.map(d => ({ ...d, x: 0, y: 0, fx: null, fy: null }));
            const links = EDGES.map(d => ({ ...d, source: d.from, target: d.to }));

            const simulation = d3.forceSimulation(nodes)
              .force("link", d3.forceLink(links).id((d) => d.id).distance(150))
              .force("charge", d3.forceManyBody().strength(-400))
              .force("center", d3.forceCenter(width / 2, height / 2));

            svg.append("defs").selectAll("marker")
              .data(["end"])
              .enter().append("marker")
              .attr("id", "arrow-graph")
              .attr("viewBox", "0 -5 10 10")
              .attr("refX", 25)
              .attr("refY", 0)
              .attr("markerWidth", 6)
              .attr("markerHeight", 6)
              .attr("orient", "auto")
              .append("path")
              .attr("d", "M0,-5L10,0L0,5")
              .attr("fill", "#52525b");

            const link = svg.append("g")
              .selectAll("line")
              .data(links)
              .join("line")
              .attr("stroke", (d) => {
                  if(d.types.includes('data')) return '#57a6ff';
                  if(d.types.includes('events')) return '#a884ff';
                  return '#4ad6b2';
              })
              .attr("stroke-opacity", 0.6)
              .attr("stroke-width", d => Math.sqrt(d.weight) * 2)
              .attr("marker-end", "url(#arrow-graph)");

            const node = svg.append("g")
              .selectAll("g")
              .data(nodes)
              .join("g")
              .call(d3.drag()
                  .on("start", dragstarted)
                  .on("drag", dragged)
                  .on("end", dragended));

            node.append("circle")
              .attr("r", 18)
              .attr("fill", "#27272a")
              .attr("stroke", "#52525b")
              .attr("stroke-width", 2);

            node.append("text")
              .text(d => d.label)
              .attr("x", 0)
              .attr("y", 32)
              .attr("text-anchor", "middle")
              .attr("fill", "#a1a1aa")
              .attr("font-size", "10px")
              .attr("font-family", "monospace");

            simulation.on("tick", () => {
              link
                .attr("x1", (d) => d.source.x)
                .attr("y1", (d) => d.source.y)
                .attr("x2", (d) => d.target.x)
                .attr("y2", (d) => d.target.y);

              node
                .attr("transform", (d) => `translate(${d.x},${d.y})`);
            });

            function dragstarted(event, d) {
              if (!event.active) simulation.alphaTarget(0.3).restart();
              d.fx = d.x;
              d.fy = d.y;
            }

            function dragged(event, d) {
              d.fx = event.x;
              d.fy = event.y;
            }

            function dragended(event, d) {
              if (!event.active) simulation.alphaTarget(0);
              d.fx = null;
              d.fy = null;
            }
          }
        }, [view]);

        return (
          <div className="flex flex-col gap-4 mt-8">
            <div className="flex items-center justify-between bg-paper border border-border p-3 rounded-xl">
              <div className="flex gap-2">
                <button 
                  onClick={() => setView('matrix')}
                  className={`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${view === 'matrix' ? 'bg-zinc-800 text-white' : 'text-zinc-400 hover:bg-zinc-800/50'}`}
                >
                  <Grid size={16} /> Matrix
                </button>
                <button 
                  onClick={() => setView('graph')}
                  className={`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${view === 'graph' ? 'bg-zinc-800 text-white' : 'text-zinc-400 hover:bg-zinc-800/50'}`}
                >
                  <Network size={16} /> Graph
                </button>
              </div>
              <div className="flex items-center gap-4 text-xs text-zinc-500">
                <div className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-core"></span> Data</div>
                <div className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-gameplay"></span> Events</div>
                <div className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-ops"></span> UX</div>
              </div>
            </div>

            <div className="flex flex-col lg:flex-row gap-6 h-[600px]">
              <div className="flex-1 bg-paper border border-border rounded-xl overflow-hidden relative">
                {view === 'matrix' ? (
                  <div className="p-6 overflow-auto h-full custom-scrollbar">
                    <div className="inline-grid grid-cols-[120px_repeat(11,minmax(40px,1fr))] gap-1">
                      <div className="h-10"></div>
                      {MODULES.map(m => (
                        <div key={m.id} className="h-32 flex items-end justify-center pb-2">
                          <span className="transform -rotate-45 text-xs text-zinc-400 font-mono whitespace-nowrap origin-bottom-left translate-x-4">{m.label}</span>
                        </div>
                      ))}
                      
                      {MODULES.map(row => (
                        <React.Fragment key={row.id}>
                          <div className="flex items-center justify-end pr-3 text-xs font-mono text-zinc-400">{row.label}</div>
                          {MODULES.map(col => {
                            const edge = EDGES.find(e => e.from === row.id && e.to === col.id);
                            return (
                              <button
                                key={`${row.id}-${col.id}`}
                                onClick={() => edge && setSelectedCell(edge)}
                                disabled={!edge}
                                className={`
                                  h-10 w-full rounded border border-white/5 transition-all
                                  ${!edge ? 'bg-zinc-900/30' : 
                                    selectedCell === edge ? 'ring-2 ring-white z-10' : 'hover:brightness-110'}
                                `}
                                style={{
                                  backgroundColor: edge ? 
                                    (edge.types.includes('data') ? 'rgba(87, 166, 255, 0.2)' : 
                                     edge.types.includes('events') ? 'rgba(168, 132, 255, 0.2)' : 
                                     'rgba(74, 214, 178, 0.2)') : undefined,
                                  opacity: edge ? 0.3 + (edge.weight * 0.15) : 1
                                }}
                              >
                                {edge && <span className="text-[10px] font-bold text-white/70">{edge.weight}</span>}
                              </button>
                            );
                          })}
                        </React.Fragment>
                      ))}
                    </div>
                  </div>
                ) : (
                  <div className="w-full h-full bg-[#0e0f12]">
                      <svg ref={svgRef} className="w-full h-full"></svg>
                  </div>
                )}
              </div>

              <div className="w-full lg:w-72 shrink-0 bg-paper border border-border rounded-xl p-5 flex flex-col">
                <h3 className="text-sm font-bold text-zinc-200 uppercase tracking-wider mb-1">Dependency Details</h3>
                <p className="text-xs text-zinc-500 mb-6">Select a connection to view details.</p>
                
                {selectedCell ? (
                  <div className="space-y-4 animate-in fade-in slide-in-from-right-4 duration-300">
                    <div className="p-3 bg-zinc-900/50 rounded-lg border border-white/5">
                      <div className="text-xs text-zinc-500 mb-1">From → To</div>
                      <div className="text-sm font-mono text-zinc-200 font-bold">
                        {MODULES.find(m => m.id === selectedCell.from)?.label} → {MODULES.find(m => m.id === selectedCell.to)?.label}
                      </div>
                    </div>
                    
                    <div className="grid grid-cols-2 gap-2">
                      <div className="p-3 bg-zinc-900/50 rounded-lg border border-white/5">
                        <div className="text-xs text-zinc-500 mb-1">Weight</div>
                        <div className="text-xl font-bold text-accent">{selectedCell.weight}</div>
                      </div>
                      <div className="p-3 bg-zinc-900/50 rounded-lg border border-white/5">
                        <div className="text-xs text-zinc-500 mb-1">Type</div>
                        <div className="flex gap-1 flex-wrap">
                          {selectedCell.types.map(t => (
                              <span key={t} className="text-[10px] uppercase px-1.5 py-0.5 rounded bg-white/10 text-white/80">{t}</span>
                          ))}
                        </div>
                      </div>
                    </div>

                    <div className="p-3 bg-zinc-900/50 rounded-lg border border-white/5">
                      <div className="text-xs text-zinc-500 mb-2">Reason</div>
                      <div className="text-sm text-zinc-300 leading-relaxed">
                        {selectedCell.reason}
                      </div>
                    </div>
                  </div>
                ) : (
                  <div className="flex-1 flex flex-col items-center justify-center text-zinc-700">
                    <Settings2 size={48} className="mb-2 opacity-20" />
                    <p className="text-sm">No selection</p>
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      };

      // ----------------------------------------------------------------------
      // VISUAL COMPONENTS (SECTIONS 5-10)
      // ----------------------------------------------------------------------

      // SECTION 5: BADGE SYSTEM (Interactive Tech Tree)
      const BadgeSystemVisual = () => {
        const [hovered, setHovered] = useState(null);
        const [unlockedIds, setUnlockedIds] = useState(new Set([1, 2]));

        // Simple DAG structure: 1->3, 2->3, 3->4, 4->6, 2->5
        // Dependencies map for logic check
        const dependencies = {
           3: [1, 2],
           4: [3],
           5: [2],
           6: [4]
        };

        const toggleBadge = (id) => {
           // Check if unlocked
           if (unlockedIds.has(id)) {
              // Lock it and all children
              const newSet = new Set(unlockedIds);
              newSet.delete(id);
              // Recursive locking would be better but simple for now:
              // Just removing simple check
              setUnlockedIds(newSet);
              return;
           }

           // Check dependencies
           const deps = dependencies[id] || [];
           const canUnlock = deps.every(d => unlockedIds.has(d));

           if (canUnlock) {
              const newSet = new Set(unlockedIds);
              newSet.add(id);
              setUnlockedIds(newSet);
           } else {
             // Shake effect logic could go here
           }
        };

        const badges = [
          { id: 1, name: "First Steps", type: "core", x: 20, y: 50 },
          { id: 2, name: "Explorer", type: "core", x: 20, y: 150 },
          { id: 3, name: "Baroque Fan", type: "gameplay", x: 120, y: 100, req: "Req: Steps + Explorer" },
          { id: 4, name: "Curator", type: "gameplay", x: 220, y: 100, req: "Req: Baroque Fan" },
          { id: 5, name: "Night Owl", type: "ops", x: 120, y: 200, req: "Req: Explorer + Night" },
          { id: 6, name: "Patron", type: "business", x: 320, y: 100, req: "Req: Curator + Subscription" },
        ];

        const connections = [
          { from: 1, to: 3 },
          { from: 2, to: 3 },
          { from: 3, to: 4 },
          { from: 4, to: 6 },
          { from: 2, to: 5 }
        ];

        return (
          <div className="bg-zinc-900/50 rounded-xl border border-white/5 p-6 relative overflow-hidden h-[300px] select-none">
            <div className="absolute top-4 left-4 flex gap-2">
               <div className="px-2 py-1 rounded bg-zinc-800 border border-zinc-700 text-[10px] font-mono text-zinc-400">DAG_RESOLVER_V2</div>
               <div className="px-2 py-1 rounded bg-accent/10 border border-accent/20 text-[10px] font-mono text-accent animate-pulse">INTERACTIVE</div>
            </div>
            
            <svg className="w-full h-full">
              <defs>
                <marker id="badge-arrow" markerWidth="10" markerHeight="10" refX="15" refY="3" orient="auto">
                  <path d="M0,0 L6,3 L0,6 Z" fill="#52525b" />
                </marker>
                <marker id="badge-arrow-active" markerWidth="10" markerHeight="10" refX="15" refY="3" orient="auto">
                  <path d="M0,0 L6,3 L0,6 Z" fill="#a884ff" />
                </marker>
              </defs>
              
              {connections.map((c, i) => {
                const startUnlocked = unlockedIds.has(c.from);
                const endUnlocked = unlockedIds.has(c.to);
                const isFlowing = startUnlocked && endUnlocked;
                
                return (
                  <path 
                    key={i}
                    d={`M${badges.find(b=>b.id===c.from).x + 30},${badges.find(b=>b.id===c.from).y + 20} C${badges.find(b=>b.id===c.from).x + 80},${badges.find(b=>b.id===c.from).y + 20} ${badges.find(b=>b.id===c.to).x - 30},${badges.find(b=>b.id===c.to).y + 20} ${badges.find(b=>b.id===c.to).x},${badges.find(b=>b.id===c.to).y + 20}`}
                    fill="none"
                    stroke={isFlowing ? "#a884ff" : (startUnlocked ? "#52525b" : "#27272a")}
                    strokeWidth={isFlowing ? "2" : "1"}
                    strokeOpacity={isFlowing ? "0.8" : "0.5"}
                    strokeDasharray={isFlowing ? "4" : "2"}
                    markerEnd={isFlowing ? "url(#badge-arrow-active)" : "url(#badge-arrow)"}
                    className={isFlowing ? "animate-flow" : ""}
                  />
                );
              })}

              {badges.map(b => {
                const isUnlocked = unlockedIds.has(b.id);
                const deps = dependencies[b.id] || [];
                const canUnlock = !isUnlocked && deps.length > 0 && deps.every(d => unlockedIds.has(d));
                
                return (
                  <g 
                    key={b.id} 
                    transform={`translate(${b.x},${b.y})`}
                    onMouseEnter={() => setHovered(b.id)}
                    onMouseLeave={() => setHovered(null)}
                    onClick={() => toggleBadge(b.id)}
                    className={`transition-all duration-300 ${canUnlock ? 'cursor-pointer hover:scale-110' : 'cursor-default'}`}
                    style={{ opacity: isUnlocked || canUnlock ? 1 : 0.5 }}
                  >
                    <path 
                      d="M15 0 L45 0 L60 20 L45 40 L15 40 L0 20 Z" 
                      fill={isUnlocked ? (b.type === 'business' ? '#ffba5c' : b.type === 'gameplay' ? '#a884ff' : '#57a6ff') : '#09090b'}
                      fillOpacity={isUnlocked ? 0.2 : 1}
                      stroke={isUnlocked ? (b.type === 'business' ? '#ffba5c' : b.type === 'gameplay' ? '#a884ff' : '#57a6ff') : (canUnlock ? '#d4d4d8' : '#27272a')}
                      strokeWidth={isUnlocked ? 2 : 1}
                      strokeDasharray={!isUnlocked && canUnlock ? "2 2" : "0"}
                    />
                    
                    <foreignObject x="18" y="8" width="24" height="24" className="pointer-events-none">
                      <div className={`flex items-center justify-center h-full ${isUnlocked ? 'text-zinc-100' : 'text-zinc-700'}`}>
                        {isUnlocked ? <Unlock size={14} /> : <Lock size={14} />}
                      </div>
                    </foreignObject>

                    <text x="30" y="55" textAnchor="middle" className={`text-[10px] font-bold tracking-wide uppercase pointer-events-none ${isUnlocked ? 'fill-zinc-300' : 'fill-zinc-700'}`}>{b.name}</text>
                    
                    {(hovered === b.id || canUnlock) && (
                      <g className="animate-in fade-in zoom-in-95 duration-200 pointer-events-none">
                        <rect x="-10" y="-35" width="80" height="25" rx="4" fill="#18181b" stroke={canUnlock ? "#a884ff" : "#3f3f46"} />
                        <text x="30" y="-20" textAnchor="middle" className={`text-[8px] font-mono ${canUnlock ? "fill-white" : "fill-zinc-500"}`}>{canUnlock ? "CLICK TO UNLOCK" : (b.req || 'Unlocked')}</text>
                      </g>
                    )}
                  </g>
                );
              })}
            </svg>
          </div>
        );
      };

      // SECTION 6: STORY ENGINE (Graph vs DAG)
      const StoryEngineVisual = () => {
        const [mode, setMode] = useState('roam');

        return (
          <div className="bg-zinc-900/50 rounded-xl border border-white/5 overflow-hidden flex flex-col h-[320px]">
            <div className="flex border-b border-white/5">
              <button 
                onClick={() => setMode('roam')}
                className={`flex-1 py-3 text-xs font-bold uppercase tracking-widest flex items-center justify-center gap-2 transition-colors ${mode === 'roam' ? 'bg-core/10 text-core border-b-2 border-core' : 'text-zinc-500 hover:text-zinc-300'}`}
              >
                <Map size={14} /> Flâneur Mode
              </button>
              <button 
                onClick={() => setMode('event')}
                className={`flex-1 py-3 text-xs font-bold uppercase tracking-widest flex items-center justify-center gap-2 transition-colors ${mode === 'event' ? 'bg-gameplay/10 text-gameplay border-b-2 border-gameplay' : 'text-zinc-500 hover:text-zinc-300'}`}
              >
                <List size={14} /> Narrative Mode
              </button>
            </div>

            <div className="relative flex-1 p-6 flex items-center justify-center bg-[url('https://www.transparenttextures.com/patterns/grid-me.png')] bg-opacity-20">
              {mode === 'roam' ? (
                <div className="relative w-full h-full animate-in fade-in duration-500">
                  <svg className="w-full h-full">
                    <defs>
                      <marker id="graph-arrow" markerWidth="10" markerHeight="10" refX="10" refY="3" orient="auto">
                        <path d="M0,0 L6,3 L0,6 Z" fill="#57a6ff" opacity="0.4" />
                      </marker>
                    </defs>
                    {/* Graph Connections with Weights */}
                    {[
                      {d: "M100 50 L200 80", w: "5m"},
                      {d: "M200 80 L250 180", w: "12m"},
                      {d: "M250 180 L150 200", w: "3m"},
                      {d: "M150 200 L50 150", w: "8m"},
                      {d: "M50 150 L100 50", w: "15m"},
                      {d: "M100 50 L150 200", w: "20m"},
                      {d: "M200 80 L50 150", w: "7m"}
                    ].map((edge, i) => (
                      <g key={i}>
                        <path d={edge.d} fill="none" stroke="#57a6ff" strokeWidth="1" strokeDasharray="4 4" opacity="0.3" markerEnd="url(#graph-arrow)" />
                        {/* Edge Weight Labels (Simplified for Demo) */}
                      </g>
                    ))}
                    
                    <text x="150" y="65" fontSize="8" fill="#57a6ff" opacity="0.7" className="font-mono bg-black">5 min</text>
                    <text x="235" y="130" fontSize="8" fill="#57a6ff" opacity="0.7" className="font-mono">12 min</text>
                    <text x="90" y="180" fontSize="8" fill="#57a6ff" opacity="0.7" className="font-mono">8 min</text>

                    {/* Nodes */}
                    {[
                      {x: 100, y: 50, id: 'A'}, {x: 200, y: 80, id: 'B'}, {x: 250, y: 180, id: 'C'}, 
                      {x: 150, y: 200, id: 'D'}, {x: 50, y: 150, id: 'E'}
                    ].map((n, i) => (
                      <g key={i} className="cursor-pointer hover:opacity-80">
                        <circle cx={n.x} cy={n.y} r="6" fill="#0e0f12" stroke="#57a6ff" strokeWidth="2" />
                        <circle cx={n.x} cy={n.y} r="15" fill="#57a6ff" opacity="0.1" className="animate-pulse" />
                        <text x={n.x} y={n.y+3} textAnchor="middle" fontSize="8" fill="#fff" fontWeight="bold">{n.id}</text>
                      </g>
                    ))}
                    
                    {/* User */}
                    <circle cx="100" cy="50" r="4" fill="#fff" stroke="#000" strokeWidth="2">
                      <animate attributeName="cx" values="100;200;50;150;100" dur="15s" repeatCount="indefinite" />
                      <animate attributeName="cy" values="50;80;150;200;50" dur="15s" repeatCount="indefinite" />
                    </circle>
                  </svg>
                  <div className="absolute bottom-2 right-2 text-right">
                    <div className="text-xs font-bold text-core">Spatial Graph</div>
                    <div className="text-[10px] text-zinc-500">Weighted Navigation</div>
                  </div>
                </div>
              ) : (
                <div className="relative w-full h-full flex items-center justify-center animate-in fade-in slide-in-from-right-8 duration-500">
                   <div className="flex items-center gap-2">
                     {[1, 2, 3, 4].map((step, i) => (
                       <React.Fragment key={i}>
                         <div className={`
                           w-14 h-20 rounded-lg border flex flex-col items-center justify-center gap-1 shadow-lg relative
                           ${i < 2 ? 'bg-gameplay/10 border-gameplay text-gameplay' : 'bg-zinc-900 border-zinc-700 text-zinc-600'}
                         `}>
                            {i === 1 && <div className="absolute -top-2 -right-2 w-3 h-3 bg-white rounded-full animate-ping" />}
                            <div className="text-[10px] font-bold">STEP {step}</div>
                            {i < 2 ? <CheckCircle2 size={14} /> : <Lock size={14} />}
                         </div>
                         {i < 3 && (
                           <div className="h-[2px] w-6 bg-zinc-800 relative">
                              <div className={`absolute inset-0 bg-gameplay transition-all duration-1000 ${i < 1 ? 'w-full' : 'w-0'}`} />
                           </div>
                         )}
                       </React.Fragment>
                     ))}
                   </div>
                   <div className="absolute bottom-2 right-2 text-right">
                    <div className="text-xs font-bold text-gameplay">Linear DAG</div>
                    <div className="text-[10px] text-zinc-500">Strict dependency sequence</div>
                  </div>
                </div>
              )}
            </div>
          </div>
        );
      };

      // SECTION 7: MONETIZATION (Interactive 3D Card)
      const MonetizationVisual = () => {
        const [flipped, setFlipped] = useState(false);

        return (
          <div className="relative h-[260px] flex items-center justify-center perspective-1000">
            <div 
              className={`relative w-80 h-52 transition-all duration-700 transform-style-3d cursor-pointer ${flipped ? 'rotate-y-180' : ''}`}
              onClick={() => setFlipped(!flipped)}
            >
              
              {/* FRONT */}
              <div className="absolute inset-0 w-full h-full backface-hidden rounded-xl bg-black border border-zinc-800 shadow-2xl overflow-hidden">
                <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                <div className="absolute inset-0 bg-gradient-to-br from-zinc-800/50 to-black"></div>
                <div className="absolute top-12 left-6 w-10 h-8 bg-gradient-to-br from-yellow-200 to-yellow-500 rounded-md border border-yellow-600 shadow-inner flex items-center justify-center">
                   <Cpu size={24} className="text-yellow-900 opacity-50" />
                </div>
                <div className="absolute top-6 right-6 opacity-50 text-zinc-500">
                  <Activity size={24} />
                </div>
                <div className="p-6 h-full flex flex-col justify-between relative z-10 pt-20">
                  <div>
                    <div className="text-[10px] font-mono text-business tracking-widest mb-1">MEMBERSHIP TIER</div>
                    <h3 className="text-2xl font-serif font-black text-transparent bg-clip-text bg-gradient-to-r from-white to-zinc-400 tracking-wide drop-shadow-sm">PATRON</h3>
                  </div>
                  <div className="flex justify-between items-end">
                     <div className="text-[10px] font-mono text-zinc-500 flex flex-col gap-1">
                        <span>ALEXANDER FLANEUR</span>
                        <span className="tracking-[0.2em]">8829 1029 4810</span>
                     </div>
                     <div className="text-right">
                        <div className="text-business font-bold font-mono text-xl">1.5x</div>
                        <div className="text-[8px] text-zinc-500 uppercase">XP Boost Active</div>
                     </div>
                  </div>
                </div>
              </div>

              {/* BACK */}
              <div className="absolute inset-0 w-full h-full backface-hidden rotate-y-180 rounded-xl bg-zinc-900 border border-zinc-700 shadow-2xl overflow-hidden p-6 flex flex-col justify-between">
                <div className="w-full h-8 bg-black -mx-6 mb-4"></div>
                <div className="flex gap-4">
                  <div className="flex-1 h-8 bg-white/10 rounded flex items-center px-2">
                     <span className="text-[10px] font-mono text-zinc-400 transform scale-x-[-1] inline-block">Authorized Signature</span>
                  </div>
                  <div className="w-12 h-8 bg-white rounded flex items-center justify-center">
                     <span className="text-black font-mono font-bold text-xs italic">882</span>
                  </div>
                </div>
                <div className="space-y-2 mt-4">
                   <div className="text-[8px] text-zinc-500 leading-tight">
                      This token grants the holder special access to curated content layers. Non-transferable.
                   </div>
                   <div className="text-[8px] text-zinc-500 leading-tight">
                      Issued by Art Flâneur Foundation.
                   </div>
                   <div className="text-[10px] text-business font-mono">EXP: 12/28</div>
                </div>
              </div>

            </div>
            
            <div className="absolute bottom-0 text-[10px] text-zinc-600 font-mono animate-pulse pointer-events-none">CLICK TO FLIP</div>
          </div>
        );
      };

      // SECTION 8: PERSONA RADAR (Animated)
      const PersonaRadar = () => {
        const size = 260;
        const center = size / 2;
        const scale = 90;
        const [frame, setFrame] = useState(0);

        useEffect(() => {
          const timer = setInterval(() => {
            setFrame(f => f + 1);
          }, 100); 
          return () => clearInterval(timer);
        }, []);

        const getVal = (base, offset) => base + Math.sin((frame + offset) * 0.1) * 0.05; 

        const points = [
          { label: "Gallerist", val: getVal(0.7, 0) },
          { label: "Historian", val: getVal(0.6, 20) },
          { label: "Dealer", val: getVal(0.4, 40) },
          { label: "Layperson", val: getVal(0.8, 60) }
        ];
        
        const ghostPoints = [{ val: 0.5 }, { val: 0.5 }, { val: 0.5 }, { val: 0.5 }];

        const polyPoints = points.map((p, i) => {
          const angle = (Math.PI / 2) * i - Math.PI / 2;
          const r = p.val * scale;
          const x = center + r * Math.cos(angle);
          const y = center + r * Math.sin(angle);
          return `${x},${y}`;
        }).join(" ");

        const ghostPolyPoints = ghostPoints.map((p, i) => {
          const angle = (Math.PI / 2) * i - Math.PI / 2;
          const r = p.val * scale;
          const x = center + r * Math.cos(angle);
          const y = center + r * Math.sin(angle);
          return `${x},${y}`;
        }).join(" ");

        const axisPoints = points.map((p, i) => {
          const angle = (Math.PI / 2) * i - Math.PI / 2;
          const x = center + scale * Math.cos(angle);
          const y = center + scale * Math.sin(angle);
          return { x, y, label: p.label };
        });

        return (
          <div className="flex flex-col items-center bg-paper rounded-xl border border-border p-6 hover:border-zinc-500 transition-colors duration-500">
            <div className="relative" style={{ width: size, height: size }}>
              <svg width={size} height={size} className="overflow-visible">
                <defs>
                  <radialGradient id="radar-glow" cx="0.5" cy="0.5" r="0.5">
                    <stop offset="0%" stopColor="#a884ff" stopOpacity="0.4" />
                    <stop offset="100%" stopColor="#a884ff" stopOpacity="0" />
                  </radialGradient>
                </defs>
                
                {[0.25, 0.5, 0.75, 1].map(r => (
                  <circle key={r} cx={center} cy={center} r={r * scale} fill="none" stroke="#27272a" strokeWidth="1" />
                ))}
                
                {axisPoints.map((p, i) => (
                   <line key={i} x1={center} y1={center} x2={p.x} y2={p.y} stroke="#27272a" strokeWidth="1" />
                ))}

                <polygon points={ghostPolyPoints} fill="none" stroke="#3f3f46" strokeWidth="1" strokeDasharray="4 2" />
                <polygon points={polyPoints} fill="url(#radar-glow)" stroke="#a884ff" strokeWidth="2" className="transition-all duration-100 ease-linear" />
                
                {points.map((p, i) => {
                   const angle = (Math.PI / 2) * i - Math.PI / 2;
                   const r = p.val * scale;
                   const x = center + r * Math.cos(angle);
                   const y = center + r * Math.sin(angle);
                   return <circle key={i} cx={x} cy={y} r="3" fill="#fff" />;
                })}

                {axisPoints.map((p, i) => (
                  <text 
                    key={i} 
                    x={p.x} 
                    y={p.y} 
                    dx={i === 1 ? 15 : i === 3 ? -15 : 0} 
                    dy={i === 0 ? -15 : i === 2 ? 20 : 5}
                    textAnchor={i === 1 ? "start" : i === 3 ? "end" : "middle"}
                    fill={i === 0 ? '#a884ff' : '#71717a'} 
                    fontSize="10" 
                    fontWeight="bold"
                    className="uppercase tracking-widest"
                  >
                    {p.label}
                  </text>
                ))}
              </svg>
            </div>
            <div className="mt-4 flex gap-4 text-[10px] text-zinc-500 font-mono">
               <span className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-gameplay animate-pulse"></div> LIVE</span>
               <span className="flex items-center gap-1"><div className="w-2 h-2 rounded-full border border-zinc-600"></div> PREV</span>
            </div>
          </div>
        );
      };

      // SECTION 9: TELEMETRY (Interactive Pipeline)
      const PrivacyFunnel = () => {
        const [packetActive, setPacketActive] = useState(false);

        const simulatePacket = () => {
           if (packetActive) return;
           setPacketActive(true);
           setTimeout(() => setPacketActive(false), 3000); // Reset after full cycle
        };

        return (
          <div className="bg-zinc-950 rounded-xl border border-border p-6 overflow-hidden relative">
             <div className="absolute top-3 right-3">
                <button 
                  onClick={simulatePacket}
                  disabled={packetActive}
                  className={`
                    px-3 py-1 text-[10px] font-bold uppercase tracking-wide rounded border transition-all
                    ${packetActive ? 'bg-zinc-800 text-zinc-500 border-zinc-700' : 'bg-ops/10 text-ops border-ops hover:bg-ops/20'}
                  `}
                >
                  {packetActive ? 'Processing...' : 'Simulate Event'}
                </button>
             </div>

             <div className="flex items-center justify-between gap-2 relative mt-8">
                
                {/* Step 1: Device */}
                <div className="z-10 flex flex-col items-center gap-3">
                   <div className={`w-12 h-12 rounded-full border flex items-center justify-center relative transition-colors duration-300 ${packetActive ? 'bg-zinc-800 border-zinc-600' : 'bg-zinc-900 border-zinc-700'}`}>
                      <Smartphone size={20} className="text-zinc-400" />
                      {packetActive && (
                        <>
                          <div className="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-ping" />
                          <div className="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full" />
                        </>
                      )}
                   </div>
                   <span className="text-[10px] uppercase font-bold text-zinc-500">Client</span>
                </div>

                {/* Stream Line 1 */}
                <div className="flex-1 h-[2px] bg-zinc-800 relative overflow-hidden">
                   {packetActive && <div className="absolute inset-0 bg-gradient-to-r from-red-500/0 via-red-500/80 to-red-500/0 w-1/3 animate-pipeline" style={{animationDuration: '1s'}} />}
                </div>

                {/* Step 2: Sanitizer */}
                <div className="z-10 flex flex-col items-center gap-3">
                   <div className={`w-16 h-16 rounded-xl border flex items-center justify-center relative transition-all duration-500 ${packetActive ? 'bg-ops/20 border-ops shadow-[0_0_20px_rgba(74,214,178,0.3)]' : 'bg-ops/10 border-ops shadow-[0_0_15px_rgba(74,214,178,0.1)]'}`}>
                      <Shield size={24} className="text-ops" />
                      <div className="absolute -bottom-6 text-[8px] font-mono text-ops bg-black px-1 border border-ops/30 rounded">STRIP_PII()</div>
                   </div>
                   <span className="text-[10px] uppercase font-bold text-ops">Sanitizer</span>
                </div>

                {/* Stream Line 2 */}
                <div className="flex-1 h-[2px] bg-zinc-800 relative overflow-hidden">
                   {packetActive && <div className="absolute inset-0 bg-gradient-to-r from-ops/0 via-ops/80 to-ops/0 w-1/3 animate-pipeline" style={{animationDelay: '0.8s', animationDuration: '1s'}} />}
                </div>

                {/* Step 3: Cloud */}
                <div className="z-10 flex flex-col items-center gap-3">
                   <div className="w-12 h-12 rounded-full bg-zinc-900 border border-zinc-700 flex items-center justify-center">
                      <Cloud size={20} className="text-zinc-400" />
                   </div>
                   <span className="text-[10px] uppercase font-bold text-zinc-500">Ingest</span>
                </div>

                {/* Stream Line 3 */}
                <div className="flex-1 h-[2px] bg-zinc-800 relative overflow-hidden">
                   {packetActive && <div className="absolute inset-0 bg-gradient-to-r from-white/0 via-white/50 to-white/0 w-1/3 animate-pipeline" style={{animationDelay: '1.5s', animationDuration: '1s'}} />}
                </div>

                {/* Step 4: DB */}
                <div className="z-10 flex flex-col items-center gap-3">
                   <div className="w-12 h-12 rounded-full bg-zinc-900 border border-zinc-700 flex items-center justify-center">
                      <Database size={20} className="text-zinc-400" />
                   </div>
                   <span className="text-[10px] uppercase font-bold text-zinc-500">Aggregate</span>
                </div>

             </div>
             
             {/* Data Transformation Visual */}
             <div className="mt-10 grid grid-cols-2 gap-4">
                <div className={`p-3 rounded border font-mono text-[10px] relative overflow-hidden transition-all duration-500 ${packetActive ? 'bg-red-900/20 border-red-900/50 text-red-300 opacity-100' : 'bg-zinc-900/50 border-zinc-800 text-zinc-600 opacity-50'}`}>
                  <div className="absolute top-0 right-0 p-1"><Lock size={10} className={packetActive ? "text-red-500" : "text-zinc-700"}/></div>
                  <div className="mb-1 opacity-50">RAW INPUT</div>
                  <div>User: "Alex_Doe"</div>
                  <div>ID: "U-882910"</div>
                  <div>Loc: 50.4501, 30.5234</div>
                </div>
                
                <div className="flex items-center justify-center">
                   <ArrowRight size={16} className={`transition-colors duration-500 ${packetActive ? 'text-zinc-400' : 'text-zinc-800'}`} />
                </div>
                
                <div className={`p-3 rounded border font-mono text-[10px] relative overflow-hidden transition-all duration-500 delay-500 ${packetActive ? 'bg-ops/10 border-ops/30 text-ops opacity-100' : 'bg-zinc-900/50 border-zinc-800 text-zinc-600 opacity-50'}`}>
                  <div className="absolute top-0 right-0 p-1"><Check size={10} className={packetActive ? "text-ops" : "text-zinc-700"}/></div>
                  <div className="mb-1 opacity-50">SANITIZED OUTPUT</div>
                  <div>User: "Session_X9"</div>
                  <div className="line-through opacity-30">ID: "U-882910"</div>
                  <div>Loc: 50.450, 30.523</div>
                </div>
             </div>
          </div>
        );
      };

      // SECTION 10: CONTENT (Update Simulation)
      const ContentVersioning = () => {
        const [status, setStatus] = useState('idle'); // idle, checking, downloading, ready

        const checkUpdate = () => {
           if (status !== 'idle') return;
           setStatus('checking');
           setTimeout(() => setStatus('downloading'), 1000);
           setTimeout(() => setStatus('ready'), 3500);
           setTimeout(() => setStatus('idle'), 6000);
        };

        return (
          <div className="flex items-center gap-8">
             <div className="flex flex-col gap-2 relative">
                {/* Base Layer */}
                <div className="w-48 p-3 bg-zinc-800 rounded-lg border border-zinc-600 flex items-center gap-3 opacity-50 transform scale-95 origin-bottom">
                   <Smartphone size={16} />
                   <div>
                      <div className="text-xs font-bold text-zinc-300">App Binary</div>
                      <div className="text-[10px] text-zinc-500">v1.0.0 (Store)</div>
                   </div>
                </div>
                
                {/* Connector */}
                <div className="h-4 w-[2px] bg-zinc-700 mx-auto"></div>

                {/* Content Layer */}
                <div className={`w-48 p-4 rounded-lg border flex flex-col gap-3 relative z-10 transition-all duration-300 ${status === 'ready' ? 'bg-green-900/20 border-green-500 shadow-[0_0_20px_rgba(34,197,94,0.2)]' : 'bg-paper border-accent shadow-[0_0_20px_rgba(255,92,0,0.15)]'}`}>
                   <div className="flex items-center gap-3">
                     <div className={`p-2 rounded transition-colors ${status === 'ready' ? 'bg-green-500/20 text-green-500' : 'bg-accent/10 text-accent'}`}>
                        {status === 'checking' ? <RefreshCcw size={18} className="animate-spin" /> : 
                         status === 'ready' ? <CheckCircle2 size={18} /> :
                         <Layers size={18} />}
                     </div>
                     <div>
                        <div className="text-xs font-bold text-white">Content Bundle</div>
                        <div className={`text-[10px] ${status === 'ready' ? 'text-green-400' : 'text-accent'}`}>
                           {status === 'idle' ? 'v1.2.4 (Current)' : status === 'ready' ? 'v1.2.5 (Installed)' : 'Checking...'}
                        </div>
                     </div>
                   </div>
                   
                   {/* Progress Bar */}
                   {status === 'downloading' && (
                     <div className="w-full h-1 bg-zinc-800 rounded-full overflow-hidden">
                        <div className="h-full bg-accent w-3/4 animate-pipeline"></div>
                     </div>
                   )}
                   
                   <div className="flex justify-between text-[8px] text-zinc-500 uppercase font-bold">
                      <span>{status === 'downloading' ? 'Downloading...' : status === 'ready' ? 'Hot Swap Complete' : 'Status: Active'}</span>
                      <span>{status === 'downloading' ? '75%' : ''}</span>
                   </div>
                </div>
             </div>

             <div className="flex-1 space-y-2">
                <div className="flex items-center justify-between">
                   <div className="text-xs font-bold uppercase text-zinc-500">Manifest.json</div>
                   <button 
                     onClick={checkUpdate}
                     disabled={status !== 'idle'}
                     className={`flex items-center gap-1 text-[10px] px-2 py-1 rounded border transition-colors ${status === 'idle' ? 'border-zinc-700 hover:bg-zinc-800 text-zinc-400' : 'border-transparent text-zinc-600'}`}
                   >
                      <RefreshCw size={10} className={status === 'checking' || status === 'downloading' ? "animate-spin" : ""} />
                      Check Updates
                   </button>
                </div>
                <div className="bg-black/30 p-3 rounded border border-white/5 font-mono text-[10px] transition-colors duration-300">
                  {[
                     { k: "bundle_id", v: "kyiv_art_week_24" },
                     { k: "min_app_ver", v: "1.0.0" },
                     { k: "assets_hash", v: status === 'ready' ? "b8e1...4a1d" : "a7f9...9b2c" },
                     { k: "quests_count", v: status === 'ready' ? "14" : "12" }
                  ].map((item, i) => (
                     <div key={i} className="flex justify-between border-b border-white/5 pb-1 mb-1 last:border-0">
                        <span className="text-zinc-500">"{item.k}":</span>
                        <span className={`transition-colors duration-500 ${item.k === 'assets_hash' && status === 'ready' ? 'text-green-400 font-bold' : 'text-green-400/70'}`}>"{item.v}"</span>
                     </div>
                  ))}
                </div>
             </div>
          </div>
        );
      };

      // ----------------------------------------------------------------------
      // MAIN APP COMPONENT
      // ----------------------------------------------------------------------

      function App() {
        const [lang, setLang] = useState('en');
        const [activeSection, setActiveSection] = useState('overview');

        const T = CONTENT[lang];
        
        const SECTIONS = useMemo(() => [
          { id: 'overview', title: T.sections.overview.title, group: 'core' },
          { id: 'core_loop', title: T.sections.core_loop.title, group: 'core' },
          { id: 'points', title: T.sections.points.title, group: 'core' },
          { id: 'characters', title: T.sections.characters.title, group: 'gameplay' },
          { id: 'quests', title: T.sections.quests.title, group: 'gameplay' },
          { id: 'badges', title: T.sections.badges.title, group: 'gameplay' },
          { id: 'stories', title: T.sections.stories.title, group: 'gameplay' },
          { id: 'monetization', title: T.sections.monetization.title, group: 'business' },
          { id: 'persona', title: T.sections.persona.title, group: 'business' },
          { id: 'telemetry', title: T.sections.telemetry.title, group: 'ops' },
          { id: 'content', title: T.sections.content.title, group: 'ops' },
          { id: 'devnotes', title: T.sections.devnotes.title, group: 'ops' },
        ], [lang, T]);

        const scrollToSection = (id) => {
          const el = document.getElementById(id);
          if (el) {
            el.scrollIntoView({ behavior: 'smooth' });
            setActiveSection(id);
          }
        };

        useEffect(() => {
          const observer = new IntersectionObserver(
            (entries) => {
              entries.forEach((entry) => {
                if (entry.isIntersecting) {
                  setActiveSection(entry.target.id);
                }
              });
            },
            { rootMargin: '-20% 0px -60% 0px' }
          );

          SECTIONS.forEach((section) => {
            const el = document.getElementById(section.id);
            if (el) observer.observe(el);
          });

          return () => observer.disconnect();
        }, [SECTIONS]);

        return (
          <div className="bg-background min-h-screen text-zinc-300 font-sans selection:bg-accent/30 selection:text-white">
            <Sidebar 
              sections={SECTIONS} 
              activeId={activeSection} 
              onNavigate={scrollToSection}
              lang={lang}
              setLang={setLang}
              text={T}
            />

            <main className="pl-0 lg:pl-80 relative">
              <div className="absolute top-0 left-0 w-full h-96 bg-gradient-to-b from-accent/5 to-transparent pointer-events-none" />

              <div className="max-w-5xl mx-auto px-6 lg:px-12 py-20">
                <header className="mb-20 relative animate-in fade-in slide-in-from-top-8 duration-700">
                  <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-accent/10 border border-accent/20 text-accent text-xs font-bold uppercase tracking-widest mb-6">
                    <Activity size={12} />
                    {T.header.badge}
                  </div>
                  <h1 className="text-4xl lg:text-6xl font-serif font-black text-white mb-6 leading-tight tracking-tight">
                    {T.header.title} <br />
                    <span className="text-zinc-500">{T.header.subtitle}</span>
                  </h1>
                  <p className="text-lg lg:text-xl text-zinc-400 max-w-2xl leading-relaxed">
                    {T.header.desc}
                  </p>
                  
                  <FeatureGrid items={[
                    { icon: <Zap size={20} />, title: T.header.features.offline.title, desc: T.header.features.offline.desc },
                    { icon: <Database size={20} />, title: T.header.features.idempotent.title, desc: T.header.features.idempotent.desc },
                    { icon: <Lock size={20} />, title: T.header.features.safeops.title, desc: T.header.features.safeops.desc },
                    { icon: <Smartphone size={20} />, title: T.header.features.content.title, desc: T.header.features.content.desc },
                  ]} />
                </header>

                <div className="space-y-16">
                  <SectionWrapper id="overview" title={T.sections.overview.title}>
                    <p className="text-lg">{T.sections.overview.intro}</p>
                    <p>{T.sections.overview.content}</p>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 my-6">
                      <div className="bg-paper p-6 rounded-xl border border-border">
                        <h3 className="font-bold text-white mb-4 text-sm uppercase tracking-wide">{T.sections.overview.keyDecisions}</h3>
                        <ul className="space-y-2 text-sm">
                          {T.sections.overview.listDecisions?.map((d, i) => (
                            <li key={i} className="flex gap-2"><span className="text-core">•</span> {d}</li>
                          ))}
                        </ul>
                      </div>
                      <div className="bg-paper p-6 rounded-xl border border-border">
                        <h3 className="font-bold text-white mb-4 text-sm uppercase tracking-wide">{T.sections.overview.nonGoals}</h3>
                        <ul className="space-y-2 text-sm text-zinc-500">
                            {T.sections.overview.listNonGoals?.map((d, i) => (
                            <li key={i} className="line-through decoration-zinc-700">{d}</li>
                          ))}
                        </ul>
                      </div>
                    </div>
                    <FlowDiagram />
                  </SectionWrapper>

                  <SectionWrapper id="core_loop" title={T.sections.core_loop.title}>
                    <p className="text-lg text-zinc-300">{T.sections.core_loop.intro}</p>
                    <Callout>
                      <b>{T.sections.core_loop.invariant}</b>
                    </Callout>
                    <div className="grid grid-cols-1 xl:grid-cols-2 gap-8">
                      <div>
                        <h4 className="font-bold text-zinc-200 mb-4">{T.sections.core_loop.stepsTitle}</h4>
                        <ul className="list-decimal list-inside space-y-3 text-sm marker:text-zinc-600">
                          {T.sections.core_loop.steps?.map((s, i) => <li key={i} className="pl-2">{s}</li>)}
                        </ul>
                      </div>
                      <StateDiagram />
                    </div>
                  </SectionWrapper>

                  <SectionWrapper id="points" title={T.sections.points.title}>
                    <p>{T.sections.points.intro}</p>
                    <CodeBlock label={T.sections.points.codeLabel || "JSON"} content={`{
  "points_balance": 120,
  "membership_active": false,
  "tx_log": [
    {
      "id": "tx.quest.q1",
      "at": 1735689600,
      "amount": 20,
      "source": "quest",
      "ref": "quest.q1"
    }
  ]
}`} />
                  </SectionWrapper>

                  <SectionWrapper id="characters" title={T.sections.characters.title}>
                    <p>{T.sections.characters.intro}</p>
                    <FeatureGrid items={[
                      { icon: <Users size={20} />, title: T.sections.characters.list[0].title, desc: T.sections.characters.list[0].desc },
                      { icon: <Flag size={20} />, title: T.sections.characters.list[1].title, desc: T.sections.characters.list[1].desc },
                      { icon: <Trophy size={20} />, title: T.sections.characters.list[2].title, desc: T.sections.characters.list[2].desc },
                      { icon: <Users size={20} />, title: T.sections.characters.list[3].title, desc: T.sections.characters.list[3].desc },
                    ]} />
                  </SectionWrapper>

                  <SectionWrapper id="quests" title={T.sections.quests.title}>
                    <p>{T.sections.quests.intro}</p>
                    <CodeBlock label={T.sections.quests.codeLabel || "JSON"} content={`{
  "id": "quest.event_biennale_01",
  "type": "event_story",
  "stops": [
    {
      "id": "s1",
      "location_id": "loc.lviv_001",
      "task": "checkin"
    },
    {
      "id": "s2",
      "location_id": "loc.lviv_011",
      "task": "qr_scan",
      "qr_hint": "B1-ART-011"
    }
  ],
  "reward": { "points": 120, "badge_id": "badge.biennale" }
}`} />
                  </SectionWrapper>

                  <SectionWrapper id="badges" title={T.sections.badges.title}>
                    <div className="grid grid-cols-1 xl:grid-cols-2 gap-8 items-start">
                      <div>
                        <p className="text-lg text-zinc-200 mb-6">{T.sections.badges.intro}</p>
                        <div className="space-y-4 text-sm">
                          <div className="p-4 bg-zinc-900/50 border-l-2 border-gameplay rounded-r-lg">
                            <h4 className="font-bold text-zinc-300 mb-2">Concept</h4>
                            <p className="leading-relaxed">{T.sections.badges.details?.concept}</p>
                          </div>
                          <div className="p-4 bg-zinc-900/50 border-l-2 border-ops rounded-r-lg">
                            <h4 className="font-bold text-zinc-300 mb-2">Technical</h4>
                            <p className="leading-relaxed font-mono text-xs">{T.sections.badges.details?.technical}</p>
                          </div>
                        </div>
                      </div>
                      <BadgeSystemVisual />
                    </div>
                  </SectionWrapper>

                  <SectionWrapper id="stories" title={T.sections.stories.title}>
                    <div className="grid grid-cols-1 xl:grid-cols-2 gap-8 items-start">
                      <div className="order-2 xl:order-1">
                        <StoryEngineVisual />
                      </div>
                      <div className="order-1 xl:order-2">
                        <p className="text-lg mb-6">{T.sections.stories.intro}</p>
                        <div className="space-y-4 text-sm">
                            <div className="p-4 bg-zinc-900/50 border border-white/5 rounded-lg">
                              <h4 className="font-bold text-zinc-300 mb-2">Concept</h4>
                              <p className="leading-relaxed">{T.sections.stories.details?.concept}</p>
                            </div>
                            <div className="p-4 bg-zinc-900/50 border border-white/5 rounded-lg">
                              <h4 className="font-bold text-zinc-300 mb-2">Technical</h4>
                              <p className="leading-relaxed font-mono text-xs">{T.sections.stories.details?.technical}</p>
                            </div>
                          </div>
                      </div>
                    </div>
                  </SectionWrapper>

                  <SectionWrapper id="monetization" title={T.sections.monetization.title}>
                    <div className="grid grid-cols-1 xl:grid-cols-2 gap-8 items-center">
                      <div>
                        <p className="text-lg mb-6">{T.sections.monetization.intro}</p>
                        <ul className="space-y-6 text-sm">
                          <li className="flex gap-4 p-4 bg-zinc-900/30 rounded-lg border border-white/5">
                            <span className="shrink-0 w-2 h-2 rounded-full bg-business mt-2"/>
                            <div>
                              <h5 className="font-bold text-zinc-300 mb-1">Access & Prestige</h5>
                              <p>{T.sections.monetization.details?.concept}</p>
                            </div>
                          </li>
                          <li className="flex gap-4 p-4 bg-zinc-900/30 rounded-lg border border-white/5">
                            <span className="shrink-0 w-2 h-2 rounded-full bg-business mt-2"/>
                            <div>
                              <h5 className="font-bold text-zinc-300 mb-1">Entitlement Logic</h5>
                              <p className="font-mono text-xs text-zinc-400">{T.sections.monetization.details?.technical}</p>
                            </div>
                          </li>
                        </ul>
                      </div>
                      <MonetizationVisual />
                    </div>
                  </SectionWrapper>

                  <SectionWrapper id="persona" title={T.sections.persona.title}>
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                        <div className="order-2 lg:order-1">
                          <PersonaRadar />
                        </div>
                        <div className="order-1 lg:order-2">
                          <p className="text-lg mb-6">{T.sections.persona.intro}</p>
                          <div className="space-y-6 text-sm">
                            <p className="leading-relaxed p-4 bg-zinc-900/50 rounded-lg border border-white/5">{T.sections.persona.details?.concept}</p>
                            <div className="p-4 bg-zinc-900 font-mono text-xs rounded border border-white/10 text-zinc-400">
                              <div className="mb-2 text-zinc-500 uppercase tracking-widest font-bold">Vector Logic</div>
                              {T.sections.persona.details?.technical}
                            </div>
                          </div>
                        </div>
                    </div>
                  </SectionWrapper>

                  <SectionWrapper id="telemetry" title={T.sections.telemetry.title}>
                    <div className="space-y-8">
                      <div className="max-w-3xl">
                          <p className="text-lg mb-6">{T.sections.telemetry.intro}</p>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm mb-8">
                            <div className="p-4 bg-zinc-900/50 rounded-lg border border-white/5">
                              <h4 className="font-bold text-zinc-300 mb-2">Strategy</h4>
                              <p>{T.sections.telemetry.details?.concept}</p>
                            </div>
                            <div className="p-4 bg-zinc-900/50 rounded-lg border border-white/5">
                              <h4 className="font-bold text-zinc-300 mb-2">Implementation</h4>
                              <p className="text-zinc-400 font-mono text-xs">{T.sections.telemetry.details?.technical}</p>
                            </div>
                          </div>
                      </div>
                      <PrivacyFunnel />
                    </div>
                  </SectionWrapper>

                  <SectionWrapper id="content" title={T.sections.content.title}>
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                        <div>
                          <p className="mb-6 text-lg">{T.sections.content.intro}</p>
                          <div className="space-y-4">
                            <p className="text-sm text-zinc-400 leading-relaxed">{T.sections.content.details?.concept}</p>
                            <p className="text-xs text-zinc-500 font-mono border-l-2 border-zinc-700 pl-4 py-2 bg-zinc-900/50 rounded-r-lg">{T.sections.content.details?.technical}</p>
                          </div>
                        </div>
                        <ContentVersioning />
                    </div>
                  </SectionWrapper>

                  <SectionWrapper id="devnotes" title={T.sections.devnotes.title}>
                    <p>{T.sections.devnotes.intro}</p>
                    <Heatmap />
                  </SectionWrapper>

                </div>
              </div>
            </main>
          </div>
        );
      }

      // ----------------------------------------------------------------------
      // MOUNT
      // ----------------------------------------------------------------------

      const rootElement = document.getElementById('root');
      if (!rootElement) {
        throw new Error("Could not find root element to mount to");
      }

      const root = createRoot(rootElement);
      root.render(
        <React.StrictMode>
          <App />
        </React.StrictMode>
      );
    </script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>
